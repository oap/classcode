<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Code Generator and Validator Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    input, button {
      padding: 5px;
      margin: 5px;
    }
    .result {
      margin-top: 15px;
    }
    .input-group {
      margin-bottom: 10px;
    }
    label {
      display: inline-block;
      width: 200px;
    }
  </style>
</head>
<body>
  <h1>Code Generator and Validator Demo</h1>
  <div>
    <h2>Generate Code</h2>
    <div class="input-group">
      <label for="generate-six-digit">Six-Digit String:</label>
      <input type="text" id="generate-six-digit" maxlength="6">
    </div>
    <div class="input-group">
      <label for="generate-three-char">Three-Character String:</label>
      <input type="text" id="generate-three-char" maxlength="3">
    </div>
    <button onclick="generateCode()">Generate Code</button>
    <div class="result" id="generated-code-result"></div>
  </div>
  <hr>
  <div>
    <h2>Validate Code</h2>
    <div class="input-group">
      <label for="validate-six-digit">Six-Digit String:</label>
      <input type="text" id="validate-six-digit" maxlength="6">
    </div>
    <div class="input-group">
      <label for="validate-three-char">Three-Character String:</label>
      <input type="text" id="validate-three-char" maxlength="3">
    </div>
    <div class="input-group">
      <label for="code-to-validate">Code to Validate:</label>
      <input type="text" id="code-to-validate" maxlength="6">
    </div>
    <button onclick="validateCode()">Validate Code</button>
    <div class="result" id="validation-result"></div>
  </div>

  <script>
    // Replace with your Cloudflare Worker URL if hosted separately
    const WORKER_BASE_URL = 'https://classcode-worker.cloudflare1-b1e.workers.dev';

    async function generateCode() {
      const sixDigitStr = document.getElementById('generate-six-digit').value.trim();
      const threeCharStr = document.getElementById('generate-three-char').value.trim();

      if (sixDigitStr.length !== 6 || threeCharStr.length !== 3) {
        alert("Please ensure the six-digit string is 6 digits and the three-character string is 3 characters long.");
        return;
      }

      try {
        const response = await fetch(`${WORKER_BASE_URL}/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sixDigitStr, threeCharStr })
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText || 'Error generating code.');
        }

        const data = await response.json();
        document.getElementById('generated-code-result').innerText = `Generated Code: ${data.code}`;
      } catch (error) {
        alert(`Error: ${error.message}`);
      }
    }

    async function validateCode() {
      const sixDigitStr = document.getElementById('validate-six-digit').value.trim();
      const threeCharStr = document.getElementById('validate-three-char').value.trim();
      const codeToValidate = document.getElementById('code-to-validate').value.trim();

      if (
        sixDigitStr.length !== 6 ||
        threeCharStr.length !== 3 ||
        codeToValidate.length !== 6
      ) {
        alert("Please ensure all input fields have the correct lengths.");
        return;
      }

      try {
        const response = await fetch(`${WORKER_BASE_URL}/validate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sixDigitStr, threeCharStr, codeToValidate })
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText || 'Error validating code.');
        }

        const data = await response.json();
        if (data.isValid) {
          const generatedAt = new Date(data.generatedTime);
          document.getElementById('validation-result').innerText = `Code is valid, generated at: ${generatedAt.toUTCString()}`;
        } else {
          document.getElementById('validation-result').innerText = `Code is invalid.`;
        }
      } catch (error) {
        alert(`Error: ${error.message}`);
      }
    }
  </script>
</body>
</html>
